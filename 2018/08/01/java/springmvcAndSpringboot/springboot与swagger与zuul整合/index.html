<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"ce3881c3"}),daovoice("update")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="swagger,"><link rel="alternate" href="/atom.xml" title="秦贺的博客" type="application/atom+xml"><meta name="description" content="1、项目结构：涉及到的服务有：api-gateway、userservice、taskservice，项目由Springboot-springcloud-jpa-fegin-consul-zuul构成微服务"><meta name="keywords" content="swagger"><meta property="og:type" content="article"><meta property="og:title" content="springboot与swagger与zuul整合 "><meta property="og:url" content="http://yoursite.com/2018/08/01/java/springmvcAndSpringboot/springboot与swagger与zuul整合/index.html"><meta property="og:site_name" content="秦贺的博客"><meta property="og:description" content="1、项目结构：涉及到的服务有：api-gateway、userservice、taskservice，项目由Springboot-springcloud-jpa-fegin-consul-zuul构成微服务"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2018-08-01T07:04:07.135Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="springboot与swagger与zuul整合 "><meta name="twitter:description" content="1、项目结构：涉及到的服务有：api-gateway、userservice、taskservice，项目由Springboot-springcloud-jpa-fegin-consul-zuul构成微服务"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"QinHe"},algolia:{applicationID:"FNMQKMRSYO",apiKey:"1c7c5f8f7f7c31886eede32da3f67ed3",indexName:"hexo",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2018/08/01/java/springmvcAndSpringboot/springboot与swagger与zuul整合/"><title>springboot与swagger与zuul整合  | 秦贺的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?df2f085ca1e73bf7063afbe80560f855";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/qinheJ" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff;color:#151513;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg><span style="color:#000;font-weight:700;position:absolute;top:0;border:0;right:0"><br><br>&emsp;Fork me on GitHub&emsp;</span></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">秦贺的博客</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="algolia-popup popup search-popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/01/java/springmvcAndSpringboot/springboot与swagger与zuul整合/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="QinHe"><meta itemprop="description" content=""><meta itemprop="image" content="/images/portrait.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="秦贺的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">springboot与swagger与zuul整合 </h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-01T15:04:07+08:00">2018-08-01</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/springmvc和springboot/" itemprop="url" rel="index"><span itemprop="name">springmvc和springboot</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2,084</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">12</span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li>1、项目结构：<br>涉及到的服务有：<br>api-gateway、userservice、taskservice，项目由Springboot-springcloud-jpa-fegin-consul-zuul构成微服务<a id="more"></a></li><li>2、网关服务：<br>其中 api-gateway 是网关服务 ，负责url的分发到各个微服务，用的是zuul，通过url匹配，在consul中找到并分发到不同服务，服务注册发现容器用的是consul，还可以用于配置项目key-value<br>consul配置如下：<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line"><span class="attr">cloud:</span> </span><br><span class="line"><span class="attr">inetutils:</span> </span><br><span class="line"><span class="attr">ignoredInterfaces:</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">docker0</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">veth.*</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">VMware.*</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">VPN.*</span> </span><br><span class="line"><span class="attr">consul:</span> </span><br><span class="line"><span class="attr">host:</span> <span class="string">consul.zhibi.config</span> </span><br><span class="line"><span class="comment">#port: 8500 </span></span><br><span class="line"><span class="attr">discovery:</span> </span><br><span class="line"><span class="attr">healthCheckInterval:</span> <span class="number">15</span><span class="string">s</span> <span class="comment">#服务中心健康检查间隔 </span></span><br><span class="line"><span class="attr">preferIpAddress:</span> <span class="literal">true</span><span class="comment">#使用外部IP注册服务，默认使用的是主机名 </span></span><br><span class="line"><span class="attr">health-check-critical-timeout:</span> <span class="number">5</span><span class="string">m</span> <span class="comment">#5分钟没有恢复服务的从服务注册中心移除 </span></span><br><span class="line"><span class="attr">instanceId:</span> <span class="string">$&#123;spring.cloud.client.hostname&#125;:$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> </span><br><span class="line"><span class="attr">config:</span> </span><br><span class="line"><span class="attr">prefix:</span> <span class="string">config</span> </span><br><span class="line"><span class="attr">defaultContext:</span> <span class="string">xiuba-apigateway</span> </span><br><span class="line"><span class="attr">profileSeparator:</span> <span class="string">','</span> </span><br><span class="line"><span class="attr">format:</span> <span class="string">PROPERTIES</span></span><br></pre></td></tr></table></figure></li></ul><p>服务分发用的是cloud全家桶中的zuul服务<br>配置如下：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">   <span class="attr">application:</span> </span><br><span class="line">      <span class="attr">name:</span> <span class="string">apigateway</span> </span><br><span class="line"><span class="attr">zuul:</span> </span><br><span class="line">     <span class="attr">ignoredServices:</span> <span class="string">'*'</span> </span><br><span class="line">    <span class="attr">routes:</span> </span><br><span class="line">         <span class="attr">user-api:</span> </span><br><span class="line">             <span class="attr">path:</span> <span class="string">/user/**</span> </span><br><span class="line">           <span class="attr">stripPrefix:</span> <span class="literal">false</span> </span><br><span class="line">           <span class="attr">serviceId:</span> <span class="string">userservice</span> </span><br><span class="line">        <span class="attr">task-api:</span> </span><br><span class="line">          <span class="attr">path:</span> <span class="string">/task/**</span> </span><br><span class="line">           <span class="attr">stripPrefix:</span> <span class="literal">false</span> </span><br><span class="line">           <span class="attr">serviceId:</span> <span class="string">taskservice</span> </span><br><span class="line">      <span class="attr">debug:</span> </span><br><span class="line">           <span class="attr">request:</span> <span class="literal">true</span> </span><br><span class="line">           <span class="attr">include-debug-header:</span> <span class="literal">true</span> </span><br><span class="line"> </span><br><span class="line">      <span class="attr">host:</span> </span><br><span class="line">          <span class="attr">connect-timeout-millis:</span> <span class="number">10000</span> </span><br><span class="line">          <span class="attr">socket-timeout-millis:</span> <span class="number">60000</span> </span><br><span class="line">          <span class="attr">max-total-connections:</span> <span class="number">1000</span> </span><br><span class="line">         <span class="attr">max-per-route-connections:</span> <span class="number">200</span> </span><br><span class="line">      <span class="attr">ribbon:</span> </span><br><span class="line">          <span class="attr">ReadTimeout:</span> <span class="number">10000</span> </span><br><span class="line">          <span class="comment">#开启饥饿模式，启动时创建好对应服务的client </span></span><br><span class="line">          <span class="attr">eager-load:</span> </span><br><span class="line">                 <span class="attr">enabled:</span> <span class="literal">true</span> </span><br><span class="line">          <span class="attr">clients:</span> <span class="string">userservice,taskservice,orderservice,payservice,searchservice</span></span><br></pre></td></tr></table></figure><p>以/user开始的url会被分配到userservice服务中，<br><br>以/task开始的url会被分派到taskservice服务中，<br><br>stripPrefix: true的时候，访问相应服务的时候会去掉前面的/user、/task前缀<br></p><ul><li>3、task、user服务<br>cloud配置：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line"><span class="attr">cloud:</span> </span><br><span class="line"><span class="attr">inetutils:</span> </span><br><span class="line"><span class="attr">ignoredInterfaces:</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">docker0</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">veth.*</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">VMware.*</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">VPN.*</span> </span><br><span class="line"><span class="attr">consul:</span> </span><br><span class="line"><span class="attr"> host:</span> <span class="string">consul.zhibi.config</span> </span><br><span class="line"> <span class="comment">#port: 8500 </span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="attr">discovery:</span> </span><br><span class="line"><span class="attr"> healthCheckInterval:</span> <span class="number">15</span><span class="string">s</span> <span class="comment">#服务中心健康检查间隔 </span></span><br><span class="line"> </span><br><span class="line"><span class="attr">preferIpAddress:</span> <span class="literal">true</span><span class="comment">#使用外部IP注册服务，默认使用的是主机名 </span></span><br><span class="line"> </span><br><span class="line"><span class="attr">health-check-critical-timeout:</span> <span class="number">5</span><span class="string">m</span> <span class="comment">#5分钟没有恢复服务的从服务注册中心移除 </span></span><br><span class="line"> </span><br><span class="line"><span class="attr">instanceId:</span> <span class="string">$&#123;spring.cloud.client.hostname&#125;:$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> </span><br><span class="line"><span class="attr"> config:</span> </span><br><span class="line"><span class="attr"> prefix:</span> <span class="string">config</span> </span><br><span class="line"><span class="attr"> defaultContext:</span> <span class="string">xiuba-task</span> </span><br><span class="line"><span class="attr"> profileSeparator:</span> <span class="string">','</span> </span><br><span class="line"><span class="attr"> format:</span> <span class="string">PROPERTIES</span></span><br></pre></td></tr></table></figure><ul><li>4、swagger的maven依赖如下：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>5、zuul-swagger配置</li></ul><p>①、SwaggerConfig.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhibi.xiuba.config; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean; </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.UiConfiguration; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2; </span><br><span class="line"> </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* Created by qinhe_admin on 2017/9/20. </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@EnableSwagger</span>2 </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Bean</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2) </span><br><span class="line">.apiInfo(apiInfo()); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder() </span><br><span class="line">.title(<span class="string">"白拿拿系统"</span>) </span><br><span class="line">.description(<span class="string">"白拿拿系统接口文档说明"</span>) </span><br><span class="line">.termsOfServiceUrl(<span class="string">"http://www.xiuba365.com"</span>) </span><br><span class="line">.contact(<span class="keyword">new</span> Contact(<span class="string">"秦贺"</span>, <span class="string">""</span>, <span class="string">"qinhelili@gmail.com"</span>)) </span><br><span class="line">.version(<span class="string">"1.0"</span>) </span><br><span class="line">.build(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Bean</span> </span><br><span class="line"><span class="function">UiConfiguration <span class="title">uiConfig</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> UiConfiguration(<span class="keyword">null</span>, <span class="string">"list"</span>, <span class="string">"alpha"</span>, <span class="string">"schema"</span>, </span><br><span class="line">UiConfiguration.Constants.DEFAULT_SUBMIT_METHODS, <span class="keyword">false</span>, <span class="keyword">true</span>); </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>②、DocumentationConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhibi.xiuba.config; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary; </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.SwaggerResource; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.SwaggerResourcesProvider; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList; </span><br><span class="line"><span class="keyword">import</span> java.util.List; </span><br><span class="line"> </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* Created by qinhe_admin on 2017/9/20. </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="meta">@Primary</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DocumentationConfig</span> <span class="keyword">implements</span> <span class="title">SwaggerResourcesProvider</span> </span>&#123; </span><br><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SwaggerResource&gt; <span class="title">get</span><span class="params">()</span> </span>&#123; </span><br><span class="line">List resources = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">resources.add(swaggerResource(<span class="string">"活动task模块API"</span>, <span class="string">"/task/v2/api-docs"</span>, <span class="string">"2.0"</span>)); </span><br><span class="line">resources.add(swaggerResource(<span class="string">"用户账户user模块API"</span>, <span class="string">"/user/v2/api-docs"</span>, <span class="string">"2.0"</span>)); </span><br><span class="line"><span class="keyword">return</span> resources; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">private</span> SwaggerResource <span class="title">swaggerResource</span><span class="params">(String name, String location, String version)</span> </span>&#123; </span><br><span class="line">SwaggerResource swaggerResource = <span class="keyword">new</span> SwaggerResource(); </span><br><span class="line">swaggerResource.setName(name); </span><br><span class="line">swaggerResource.setLocation(location); </span><br><span class="line">swaggerResource.setSwaggerVersion(version); </span><br><span class="line"><span class="keyword">return</span> swaggerResource; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>6、task和user服务的swagger配置</li></ul><p>配置：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">xiuba:</span> </span><br><span class="line"><span class="attr">swagger:</span> </span><br><span class="line"><span class="attr">title:</span> <span class="string">活动task模块API</span> </span><br><span class="line"><span class="attr">description:</span> <span class="string">活动模块接口文档说明</span> </span><br><span class="line"><span class="attr">termsOfServiceUrl:</span> <span class="attr">http://www.xiuba365.com/</span> </span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span> </span><br><span class="line"><span class="attr">basePackage:</span> <span class="string">com.zhibi.xiuba.controller</span> </span><br><span class="line"><span class="attr">module:</span> <span class="string">task</span> </span><br><span class="line"><span class="attr">xiuba:</span> </span><br><span class="line"><span class="attr">swagger:</span> </span><br><span class="line"><span class="attr">title:</span> <span class="string">用户账户user模块API</span> </span><br><span class="line"><span class="attr">description:</span> <span class="string">用户账户模块接口文档说明</span> </span><br><span class="line"><span class="attr">termsOfServiceUrl:</span> <span class="attr">http://www.xiuba365.com/</span> </span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span> </span><br><span class="line"><span class="attr">basePackage:</span> <span class="string">com.zhibi.xiuba.controller</span> </span><br><span class="line"><span class="attr">module:</span> <span class="string">user</span></span><br></pre></td></tr></table></figure><p>SwaggerConfig.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhibi.xiuba.configers; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties; </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean; </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.UiConfiguration; </span><br><span class="line"> </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* Created by qinhe_admin on 2017/9/20. </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"xiuba.swagger"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> String title; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> String description; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> String termsOfServiceUrl; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> String version; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> String basePackage; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> title; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123; </span><br><span class="line"><span class="keyword">this</span>.title = title; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> description; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123; </span><br><span class="line"><span class="keyword">this</span>.description = description; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getTermsOfServiceUrl</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> termsOfServiceUrl; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTermsOfServiceUrl</span><span class="params">(String termsOfServiceUrl)</span> </span>&#123; </span><br><span class="line"><span class="keyword">this</span>.termsOfServiceUrl = termsOfServiceUrl; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getVersion</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> version; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVersion</span><span class="params">(String version)</span> </span>&#123; </span><br><span class="line"><span class="keyword">this</span>.version = version; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBasePackage</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> basePackage; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBasePackage</span><span class="params">(String basePackage)</span> </span>&#123; </span><br><span class="line"><span class="keyword">this</span>.basePackage = basePackage; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Bean</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2) </span><br><span class="line">.apiInfo(apiInfo()) </span><br><span class="line">.select() </span><br><span class="line">.apis(RequestHandlerSelectors.basePackage(basePackage)) </span><br><span class="line"><span class="comment">//                .apis(RequestHandlerSelectors.withClassAnnotation(Api.class)) </span></span><br><span class="line"><span class="comment">//                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class)) </span></span><br><span class="line">.paths(PathSelectors.any()) </span><br><span class="line">.build(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder() </span><br><span class="line">.title(title) </span><br><span class="line">.description(description) </span><br><span class="line">.termsOfServiceUrl(termsOfServiceUrl) </span><br><span class="line">.contact(<span class="keyword">new</span> Contact(<span class="string">"秦贺"</span>, <span class="string">""</span>, <span class="string">"qinhelili@gmail.com"</span>)) </span><br><span class="line">.version(version) </span><br><span class="line">.build(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Bean</span> </span><br><span class="line"><span class="function">UiConfiguration <span class="title">uiConfig</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> UiConfiguration(<span class="keyword">null</span>, <span class="string">"list"</span>, <span class="string">"alpha"</span>, <span class="string">"schema"</span>, UiConfiguration.Constants.DEFAULT_SUBMIT_METHODS, <span class="keyword">false</span>, <span class="keyword">true</span>); </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改源代码的url：</p><p>Swagger2Controller.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhibi.xiuba.configers; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Optional; </span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Strings; </span><br><span class="line"><span class="keyword">import</span> io.swagger.models.Swagger; </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired; </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties; </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment; </span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus; </span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity; </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.UriComponents; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.annotations.ApiIgnore; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Documentation; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.DocumentationCache; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.PropertySourcedMapping; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.json.Json; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.json.JsonSerializer; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket; </span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.mappers.ServiceModelToSwagger2Mapper; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.common.base.Strings.isNullOrEmpty; </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.zhibi.xiuba.configers.HostNameProvider.componentsFrom; </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.util.MimeTypeUtils.APPLICATION_JSON_VALUE; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span> </span><br><span class="line"><span class="meta">@ApiIgnore</span> </span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"xiuba.swagger"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Controller</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> String <span class="keyword">module</span>; </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HAL_MEDIA_TYPE = <span class="string">"application/hal+json"</span>; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String hostNameOverride; </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DocumentationCache documentationCache; </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ServiceModelToSwagger2Mapper mapper; </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> JsonSerializer jsonSerializer; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getModule</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">module</span>; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setModule</span><span class="params">(String <span class="keyword">module</span>)</span> </span>&#123; </span><br><span class="line"><span class="keyword">this</span>.<span class="keyword">module</span> = <span class="keyword">module</span>; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Autowired</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Swagger2Controller</span><span class="params">( </span></span></span><br><span class="line"><span class="function"><span class="params">Environment environment, </span></span></span><br><span class="line"><span class="function"><span class="params">DocumentationCache documentationCache, </span></span></span><br><span class="line"><span class="function"><span class="params">ServiceModelToSwagger2Mapper mapper, </span></span></span><br><span class="line"><span class="function"><span class="params">JsonSerializer jsonSerializer)</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">this</span>.hostNameOverride = environment.getProperty(<span class="string">"springfox.documentation.swagger.v2.host"</span>, <span class="string">"DEFAULT"</span>); </span><br><span class="line"><span class="keyword">this</span>.documentationCache = documentationCache; </span><br><span class="line"><span class="keyword">this</span>.mapper = mapper; </span><br><span class="line"><span class="keyword">this</span>.jsonSerializer = jsonSerializer; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/&#123;module&#125;/v2/api-docs"</span>, method = RequestMethod.GET, produces = &#123;APPLICATION_JSON_VALUE, HAL_MEDIA_TYPE&#125;) </span><br><span class="line"><span class="meta">@PropertySourcedMapping</span>( </span><br><span class="line">value = <span class="string">"$&#123;springfox.documentation.swagger.v2.path&#125;"</span>, </span><br><span class="line">propertyKey = <span class="string">"springfox.documentation.swagger.v2.path"</span>) </span><br><span class="line"><span class="meta">@ResponseBody</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Json&gt; <span class="title">getDocumentation</span><span class="params">( </span></span></span><br><span class="line"><span class="function"><span class="params">@RequestParam(value = <span class="string">"group"</span>, required = <span class="keyword">false</span>)</span> String swaggerGroup, </span></span><br><span class="line"><span class="function">@<span class="title">PathVariable</span><span class="params">(value = <span class="string">"module"</span>, required = <span class="keyword">true</span>)</span> String <span class="keyword">module</span>, </span></span><br><span class="line"><span class="function">HttpServletRequest servletRequest) </span>&#123; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (org.apache.commons.lang3.StringUtils.isNotBlank(<span class="keyword">module</span>) &amp;&amp; <span class="keyword">module</span>.equalsIgnoreCase(<span class="keyword">this</span>.<span class="keyword">module</span>)) &#123; </span><br><span class="line">String groupName = Optional.fromNullable(swaggerGroup).or(Docket.DEFAULT_GROUP_NAME); </span><br><span class="line">Documentation documentation = documentationCache.documentationByGroup(groupName); </span><br><span class="line"><span class="keyword">if</span> (documentation == <span class="keyword">null</span>) &#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Json&gt;(HttpStatus.NOT_FOUND); </span><br><span class="line">&#125; </span><br><span class="line">Swagger swagger = mapper.mapDocumentation(documentation); </span><br><span class="line">UriComponents uriComponents = componentsFrom(servletRequest, swagger.getBasePath()); </span><br><span class="line">swagger.basePath(Strings.isNullOrEmpty(uriComponents.getPath()) ? <span class="string">"/"</span> : uriComponents.getPath()); </span><br><span class="line"><span class="keyword">if</span> (isNullOrEmpty(swagger.getHost())) &#123; </span><br><span class="line">swagger.host(hostName(uriComponents)); </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Json&gt;(jsonSerializer.toJson(swagger), HttpStatus.OK); </span><br><span class="line">&#125;<span class="keyword">else</span> &#123; </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Json&gt;(HttpStatus.NOT_FOUND); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">hostName</span><span class="params">(UriComponents uriComponents)</span> </span>&#123; </span><br><span class="line"><span class="keyword">if</span> (<span class="string">"DEFAULT"</span>.equals(hostNameOverride)) &#123; </span><br><span class="line">String host = uriComponents.getHost(); </span><br><span class="line"><span class="keyword">int</span> port = uriComponents.getPort(); </span><br><span class="line"><span class="keyword">if</span> (port &gt; -<span class="number">1</span>) &#123; </span><br><span class="line"><span class="keyword">return</span> String.format(<span class="string">"%s:%d"</span>, host, port); </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> host; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> hostNameOverride; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HostNameProvider.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhibi.xiuba.configers; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServletServerHttpRequest; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.ServletUriComponentsBuilder; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.UriComponents; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.UriComponentsBuilder; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.UrlPathHelper; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.util.StringUtils.hasText; </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.servlet.support.ServletUriComponentsBuilder.fromContextPath; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HostNameProvider</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HostNameProvider</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> UriComponents <span class="title">componentsFrom</span><span class="params">( </span></span></span><br><span class="line"><span class="function"><span class="params">HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">String basePath)</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">ServletUriComponentsBuilder builder = fromServletMapping(request, basePath); </span><br><span class="line"> </span><br><span class="line">UriComponents components = UriComponentsBuilder.fromHttpRequest( </span><br><span class="line"><span class="keyword">new</span> ServletServerHttpRequest(request)) </span><br><span class="line">.build(); </span><br><span class="line"> </span><br><span class="line">String host = components.getHost(); </span><br><span class="line"><span class="keyword">if</span> (!hasText(host)) &#123; </span><br><span class="line"><span class="keyword">return</span> builder.build(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">builder.host(host); </span><br><span class="line">builder.port(components.getPort()); </span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> builder.build(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ServletUriComponentsBuilder <span class="title">fromServletMapping</span><span class="params">( </span></span></span><br><span class="line"><span class="function"><span class="params">HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">String basePath)</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">ServletUriComponentsBuilder builder = fromContextPath(request); </span><br><span class="line"> </span><br><span class="line">builder.replacePath(prependForwardedPrefix(request, basePath)); </span><br><span class="line"><span class="keyword">if</span> (hasText(<span class="keyword">new</span> UrlPathHelper().getPathWithinServletMapping(request))) &#123; </span><br><span class="line">builder.path(request.getServletPath()); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> builder; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">prependForwardedPrefix</span><span class="params">( </span></span></span><br><span class="line"><span class="function"><span class="params">HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">String path)</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">String prefix = request.getHeader(<span class="string">"X-Forwarded-Prefix"</span>); </span><br><span class="line"><span class="keyword">if</span> (prefix != <span class="keyword">null</span>) &#123; </span><br><span class="line"><span class="keyword">return</span> prefix + path; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"><span class="keyword">return</span> path; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>7、访问</li></ul><p>访问api-gateway微服务的swagger-ui,通过此服务的ui间接访问其他服务的接口文档数据<br>http://{ip}:{port}/swagger-ui.html</p></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/2018/08/01/java/springmvcAndSpringboot/springboot与swagger与zuul整合/">springboot与swagger与zuul整合 </a></p><p><span>文章作者:</span><a href="/" title="访问 QinHe 的个人博客">QinHe</a></p><p><span>发布时间:</span>2018年08月01日 - 15:08</p><p><span>最后更新:</span>2018年08月01日 - 15:08</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"> <img id="wechat_subscriber_qcode" src="/images/wechat-qcode.jpg" alt="QinHe wechat" style="width:200px;max-width:100%"><div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div></div></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/swagger/" rel="tag"><i class="fa fa-tag"></i> swagger</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/08/01/java/springmvcAndSpringboot/springboot配置文件/" rel="next" title="springboot配置文件 "><i class="fa fa-chevron-left"></i> springboot配置文件 </a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/08/01/java/springmvcAndSpringboot/springboot定时任务/" rel="prev" title="springboot定时任务 ">springboot定时任务 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b3f66ffa7f921c2" async="async"></script></div></div></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNzkxMC8xNDQ0MA=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/portrait.jpg" alt="QinHe"><p class="site-author-name" itemprop="name">QinHe</p><p class="site-description motion-element" itemprop="description">我的征途是星辰大海</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">35</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/qinheJ" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:qinheJ@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://plus.google.com/qinheJ" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span><span class="links-of-author-item"><a href="https://twitter.com/yourname" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a></li><li class="links-of-blogroll-item"> <a href="http://example.com/" title="Title" target="_blank">Title</a></li></ul></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">QinHe</span><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_pv">本站访客数:<span id="busuanzi_value_site_pv"></span></span></div></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共42.8k字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/lib/three/three.min.js"></script><script type="text/javascript" src="/lib/three/three-waves.min.js"></script><script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css"><script src="/lib/algolia-instant-search/instantsearch.min.js"></script><script src="/js/src/algolia-search.js?v=5.1.4"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",display:{position:"right",width:100,height:150},mobile:{show:!1}})</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>