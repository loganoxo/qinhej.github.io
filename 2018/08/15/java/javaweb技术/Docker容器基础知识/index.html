<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"ce3881c3"}),daovoice("update")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Docker,"><link rel="alternate" href="/atom.xml" title="秦贺的博客" type="application/atom+xml"><meta name="description" content="一、增加linux的dns（永久）##1、运行命令："><meta name="keywords" content="Docker"><meta property="og:type" content="article"><meta property="og:title" content="Docker容器基础知识"><meta property="og:url" content="http://yoursite.com/2018/08/15/java/javaweb技术/Docker容器基础知识/index.html"><meta property="og:site_name" content="秦贺的博客"><meta property="og:description" content="一、增加linux的dns（永久）##1、运行命令："><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://img-blog.csdn.net/20180809220515121?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809220719961?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809220841513?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221034490?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221106226?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221203132?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221227469?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221249518?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221344578?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221841415?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221900753?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809221945480?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809222005522?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809222244245?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:image" content="https://img-blog.csdn.net/20180809222434584?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="og:updated_time" content="2018-08-15T10:35:57.318Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker容器基础知识"><meta name="twitter:description" content="一、增加linux的dns（永久）##1、运行命令："><meta name="twitter:image" content="https://img-blog.csdn.net/20180809220515121?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"QinHe"},algolia:{applicationID:"FNMQKMRSYO",apiKey:"1c7c5f8f7f7c31886eede32da3f67ed3",indexName:"hexo",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2018/08/15/java/javaweb技术/Docker容器基础知识/"><title>Docker容器基础知识 | 秦贺的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?df2f085ca1e73bf7063afbe80560f855";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/qinheJ" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff;color:#151513;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg><span style="color:#000;font-weight:700;position:absolute;top:0;border:0;right:0"><br><br>&emsp;Fork me on GitHub&emsp;</span></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">秦贺的博客</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="algolia-popup popup search-popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/15/java/javaweb技术/Docker容器基础知识/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="QinHe"><meta itemprop="description" content=""><meta itemprop="image" content="/images/portrait.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="秦贺的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Docker容器基础知识</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-15T18:35:57+08:00">2018-08-15</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javaweb技术/" itemprop="url" rel="index"><span itemprop="name">javaweb技术</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5,853</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">24</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="一、增加linux的dns（永久）"><a href="#一、增加linux的dns（永久）" class="headerlink" title="一、增加linux的dns（永久）"></a>一、增加linux的dns（永久）</h1><p>##1、运行命令：<br><a id="more"></a><br> cd /etc/sysconfig/network-scripts/<br> ls</p><p>##2、找到该目录下的网卡配置文件如:ifcfg-ens32，在其中添加三行，如果文件中已经有了DNS,就先删除再添加：</p><p> PEERD=no<br> DNS1=8.8.8.8<br> DNS2=114.144.114.114</p><p>##3、添加完之后运行命令：</p><p> #重启网络服务，使更改生效<br> service network restart</p><p>##4、重启系统看dns是否还存在</p><h1 id="二、docker安装"><a href="#二、docker安装" class="headerlink" title="二、docker安装"></a>二、docker安装</h1><p>##1、用yum国内源<br>备份：mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup<br>wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="http://mirrors.aliyun.com/repo/Centos-7.repo" target="_blank" rel="noopener">http://mirrors.aliyun.com/repo/Centos-7.repo</a></p><p>##2、添加docker yum源<br>sudo yum-config-manager –add-repo <a href="https://download.docker.com/linux/centos/docker-ce.repo" target="_blank" rel="noopener">https://download.docker.com/linux/centos/docker-ce.repo</a></p><p>之后运行yum makecache生成缓存</p><p>##3、删除以前版本的docker<br>删除上次的docker目录<br>rm -rf /var/lib/docker/<br>rm -rf /var/run/docker/</p><p>sudo yum remove docker docker-common docker-selinux docker-engine</p><p>##4、用yum安装<br>执行以下命令安装依赖包：<br>sudo yum install -y yum-utils device-mapper-persistent-data lvm2<br>安装docker-ce<br>sudo yum install docker-ce</p><p>##5、启动 Docker CE<br>sudo systemctl enable docker<br>sudo systemctl start docker<br>— sudo：是linux系统管理指令，是允许系统管理员让普通用户执行一些或者全部的root命令的一个工具<br>— systemctl：是一个系统管理守护进程、工具和库的集合，用于取代System V、service和chkconfig命令，初始进程主要负责控制systemd系统和服务管理器。通过Systemctl –help可以看到该命令主要分为：查询或发送控制命令给systemd服务，管理单元服务的命令，服务文件的相关命令，任务、环境、快照相关命令，systemd服务的配置重载，系统开机关机相关的命令</p><p>##6、建立 docker 用户组<br>默认情况下， docker 命令会使用 Unix socket 与 Docker 引擎通讯。而只有 root 用户和 docker 组的用户才可以访问 Docker 引擎的 Unix socket。出于安全考虑，一般 Linux 系统 上不会直接使用 root 用户。因此，更好地做法是将需要使用 docker 的用户加入 docker 用户组。<br>–建立 docker 组：<br>sudo groupadd docker<br>–将当前用户加入 docker 组：<br>sudo usermod -aG docker qinhe 退出当前终端并重新登录，进行如下测试。</p><p>##7、重启 docker 服务<br>sudo service docker restart</p><p>切换当前会话到新 group 或者重启 X 会话<br>newgrp - docker</p><p>##8、镜像加速器<br>国内从 Docker Hub 拉取镜像有时会遇到困难，此时可以配置镜像加速器。Docker 官方和国<br>内很多云服务商都提供了国内加速器服务，例如：<br><a href="https://cr.console.aliyun.com/?spm=a2c4e.11153940.blogcont29941.9.538f69d6xKBg35#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/?spm=a2c4e.11153940.blogcont29941.9.538f69d6xKBg35#/accelerator</a></p><p>如何配置镜像加速器<br>针对Docker客户端版本大于1.10.0的用户<br>您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器：</p><p>sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json &lt;&lt;-‘EOF’<br>{<br> “registry-mirrors”: [“<a href="https://cup2aba1.mirror.aliyuncs.com&quot;]" target="_blank" rel="noopener">https://cup2aba1.mirror.aliyuncs.com&quot;]</a><br>}<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker</p><p>上面配置可能是错的：</p><p>用这个：<br>curl -sSL <a href="https://get.daocloud.io/daotools/set_mirror.sh" target="_blank" rel="noopener">https://get.daocloud.io/daotools/set_mirror.sh</a> | sh -s <a href="https://cup2aba1.mirror.aliyuncs.com" target="_blank" rel="noopener">https://cup2aba1.mirror.aliyuncs.com</a></p><p>sudo sed -i “s|ExecStart=/usr/bin/dockerd|ExecStart=/usr/bin/dockerd –registry-mirror=<a href="https://cup2aba1.mirror.aliyuncs.com|g&quot;" target="_blank" rel="noopener">https://cup2aba1.mirror.aliyuncs.com|g&quot;</a> /etc/systemd/system/docker.service<br>sudo systemctl daemon-reload<br>sudo service docker restart</p><p>在命令行 执行 docker info ，如果从结果中看到了如下内容，说明配置成功。</p><p><img src="https://img-blog.csdn.net/20180809220515121?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>##9、测试 Docker 是否安装正确<br>docker run hello-world</p><blockquote><p>Unable to find image ‘hello-world:latest’ locally<br>latest: Pulling from library/hello-world<br>ca4f61b1923c: Pull complete<br>Digest: sha256:be0cd392e45be79ffeffa6b05338b98ebb16c87b255f48e297ec7f98e123905c<br>Status: Downloaded newer image for hello-world:latest<br>Hello from Docker!<br>This message shows that your installation appears to be working correctly.<br>To generate this message, Docker took the following steps:</p><ol><li>The Docker client contacted the Docker daemon.</li><li>The Docker daemon pulled the “hello-world” image from the Docker Hub.<br>(amd64)</li><li>The Docker daemon created a new container from that image which runs the<br>executable that produces the output you are currently reading.</li><li>The Docker daemon streamed that output to the Docker client, which sent it<br>to your terminal.<br>To try something more ambitious, you can run an Ubuntu container with:<br>$ docker run -it ubuntu bash<br>Share images, automate workflows, and more with a free Docker ID:<br><a href="https://cloud.docker.com/" target="_blank" rel="noopener">https://cloud.docker.com/</a><br>For more examples and ideas, visit:<br><a href="https://docs.docker.com/engine/userguide/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/</a><br>若能正常输出以上信息，则说明安装成功。</li></ol></blockquote><p>用阿里云镜像会很慢，可以用这个：<br><a href="http://hub-mirror.c.163.com/" target="_blank" rel="noopener">http://hub-mirror.c.163.com/</a></p><p>##10、配置阿里云镜像仓库<br>创建阿里云镜像仓库：</p><p> <img src="https://img-blog.csdn.net/20180809220719961?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>–登录阿里云docker registry:<br> sudo docker login <a href="mailto:--username=qinhelili@163.com" target="_blank" rel="noopener">--username=qinhelili@163.com</a> registry.cn-hangzhou.aliyuncs.com<br> 登录registry的用户名是您的阿里云账号全名，密码是您开通服务时设置的密码。<br> 你可以在镜像管理首页点击右上角按钮修改docker login密码。</p><p>–将镜像推送到registry：<br> sudo docker login <a href="mailto:--username=qinhelili@163.com" target="_blank" rel="noopener">--username=qinhelili@163.com</a> registry.cn-hangzhou.aliyuncs.com<br> sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository:[镜像版本号]<br> sudo docker push registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository:[镜像版本号]<br> 其中[ImageId],[镜像版本号]请你根据自己的镜像信息进行填写。</p><p>–从registry中拉取镜像：<br> sudo docker pull registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository:[镜像版本号]</p><p>–注意您的网络环境<br> 从ECS推送镜像时，可以选择走内网，速度将大大提升，并且将不会损耗您的公网流量。<br> 如果您申请的机器是在经典网络，请使用 registry-internal.cn-hangzhou.aliyuncs.com 作为registry的域名登录, 并作为镜像名空间前缀<br> 如果您申请的机器是在vpc网络的，请使用 registry-vpc.cn-hangzhou.aliyuncs.com 作为registry的域名登录, 并作为镜像名空间前缀</p><p>–sample:<br> 使用docker tag重命名镜像，并将它通过推送至registry：<br> ①、sudo docker login <a href="mailto:--username=qinhelili@163.com" target="_blank" rel="noopener">--username=qinhelili@163.com</a> registry.cn-hangzhou.aliyuncs.com<br> 输入密码<br> ②、sudo docker images<br> <img src="https://img-blog.csdn.net/20180809220841513?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>③、tag<br> sudo docker tag hello-world registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository/hello-world:he<br><img src="https://img-blog.csdn.net/20180809221034490?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>④、push<br> sudo docker push registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository/hello-world:he<br> 出错：仓库名不对<br><img src="https://img-blog.csdn.net/20180809221106226?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>⑤、tag<br> sudo docker tag hello-world registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository:he</p><p><img src="https://img-blog.csdn.net/20180809221203132?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>⑥、push<br> sudo docker push registry.cn-hangzhou.aliyuncs.com/qinhe/qinhe_repository:he<br> 成功<br><img src="https://img-blog.csdn.net/20180809221227469?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>⑦、阿里云仓库</p><p><img src="https://img-blog.csdn.net/20180809221249518?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>##11、pull centos7<br> docker pull centos:7</p><p>##12、run centos7</p><p>docker run -it –rm centos:7 bash<br> docker run 就是运行容器的命令，具体格式我们会在 容器 一节进行详细讲解，我们这里简<br> 要的说明一下上面用到的参数。<br> -it ：这是两个参数，一个是 -i ：交互式操作，一个是 -t 终端。我们这里打算进入bash 执行一些命令并查看返回结果，因此我们需要交互式终端。<br> –rm ：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 docker rm 。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 –rm 可以避免浪费空间。<br> bash ：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 bash 。进入容器后，我们可以在 Shell 下操作，执行任何所需的命令。这里，我们执行了 cat/etc/os-release ，这是 Linux 常用的查看当前系统版本的命令，最后我们通过 exit 退出了这个容器。</p><blockquote><p>-d: 后台运行容器，并返回容器ID；某些时候需要进入容器进行操作，包括使用 docker attach 命令或 docker exec 命令，推荐 大家使用 docker exec 命令<br> –name=”nginx-lb”: 为容器指定一个名称；<br>–dns 8.8.8.8: 指定容器使用的DNS服务器，默认和宿主一致；<br> –dns-search example.com: 指定容器DNS搜索域名，默认和宿主一致；<br> -h “mars”: 指定容器的hostname；<br> -e username=”ritchie”: 设置环境变量；<br> –env-file=[]: 从指定文件读入环境变量；<br> –cpuset=”0-2” or –cpuset=”0,1,2”: 绑定容器到指定CPU运行；<br> -m :设置容器使用内存最大值；<br> –net=”bridge”: 指定容器的网络连接类型，支持 bridge/host/none/container: 四种类型；<br> –link=[]: 添加链接到另一个容器；<br> –expose=[]: 开放一个端口或一组端口<br>docker run -d –name centos centos:7<br>运行了就关闭了，因为 Docker容器后台运行,就必须有一个前台进程.容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail），就是会自动退出的<br>可以这样：<br>docker run -itd –name centos centos:7<br>或者：<br>docker run -it –name centos centos:7<br>然后ctrl+Q+P 退出交互式终端但不退出容器<br>或者：<br>docker run -it –name centos centos:7 ping 127.0.0.1<br>查看日志：<br>docker logs -ft –tail=1 37</p></blockquote><p><img src="https://img-blog.csdn.net/20180809221344578?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>#四、如何通过Dockerfile快速构建镜像<br>接下来，我们通过构建一个Tomcat镜像，来演示Dockerfile的使用方法，当然前提是你的电脑安装了Docker环境，如何安装Docker环境就不在此赘述了。</p><p>##1、创建一个Dockerfile<br>Dockerfile命名必须为“Dockerfile”，Docker镜像构建时，会查找指定目录中的Dockerfile。</p><p>##2、编写Dockerfile<br>（1）环境配置<br>FROM ubuntu:14.04<br>通过FROM指令，Docker编译程序能够知道通过哪个基础镜像执行来进行编译。所有的Dockerfile都必须以FROM指令开始。通过该指令，我们相当于有了一个最基本的Ubuntu系统。<br>（2）其他环境配置<br>MAINTAINER example <a href="mailto:&#101;&#x78;&#97;&#109;&#x70;&#x6c;&#101;&#64;&#x67;&#111;&#x6f;&#100;&#x72;&#x61;&#105;&#110;&#46;&#x63;&#111;&#109;" target="_blank" rel="noopener">&#101;&#x78;&#97;&#109;&#x70;&#x6c;&#101;&#64;&#x67;&#111;&#x6f;&#100;&#x72;&#x61;&#105;&#110;&#46;&#x63;&#111;&#109;</a><br>另外我们需要指定时区，否则我们做出的镜像可能会跟当前时间不符。<br>RUN echo “Asia/Shanghai” &gt; /etc/timezone;dpkg-reconfigure -f noninteractive tzdata<br>我们可以像在电脑上安装Tomcat一样，把Tomcat安装在Docker容器中。<br>（3）Tomcat必要软件安装。<br>我们此时使用的Ubuntu系统其实是很简陋的系统，上面很多系统都没有。所以我先安装一些必要的软件。<br>RUN apt-get update &amp;&amp; apt-get install -y curl vim net-tools &amp;&amp; \<br>rm -rf /var/lib/apt/lists/* &amp;&amp; mkdir -p /app<br>RUN指令用来在Docker的编译环境中运行指定命令。这里我安装了curl、vim、net-tools，其中curl用来获取java和tomcat的安装包，vim和net-tools用来调试，并创建了/app目录。<br>（4）指定工作目录<br>使用 WORKDIR /app 可以将工作目录定位到/app 目录下<br>（5）获取安装软件<br>我们使用第 （3）步安装的 curl 工具来获取安装包。<br>RUN curl -L ‘<a href="http://download.oracle.com/otn-pub/java/jdk/7u65-b17/jdk-7u65-linux-x64.tar.gz&#39;" target="_blank" rel="noopener">http://download.oracle.com/otn-pub/java/jdk/7u65-b17/jdk-7u65-linux-x64.tar.gz&#39;</a> -H ‘Cookie: oraclelicense=accept-securebackup-cookie; gpw_e24=Dockerfile’ | tar -xz \<br> &amp;&amp; curl -L ‘<a href="http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.8/bin/apache-tomcat-7.0.8.tar.gz&#39;" target="_blank" rel="noopener">http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.8/bin/apache-tomcat-7.0.8.tar.gz&#39;</a> | tar -xz<br>以上命令将会从指定地址下载安装包，并解压到当前目录（上一步我们指定了工作空间为/app，所以会解压到此目录下）<br>（6）指定运行脚本<br>截止到上一步，我们已经将需要的准备工作都做好了，剩下的还有Java环境变量的设置，Tomcat环境变量设置（非必须）和Tomcat的启动。<br>COPY tomcat7.sh /app/tomcat7.sh<br>RUN chmod +x /app/tomcat7.sh<br>上面的两行命令会将与Dockerfile同级目录的tomcat7.sh文件上传到docker容器中的/app目录下，并且给该文件赋予可执行的权限。<br>看一眼该脚本的内容便一目了然了。<br>Java环境变量配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/app/jdk1.7.0_65 </span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH </span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar # Tomcat环境变量配置 </span><br><span class="line">export TOMCAT_HOME=/app/apache-tomcat-7.0.8 </span><br><span class="line">export PATH=$TOMCAT_HOME/bin:$PATH # 启动 Tomcat </span><br><span class="line">exec $TOMCAT_HOME/bin/catalina.sh run</span><br></pre></td></tr></table></figure><p>（7）指定端口<br>EXPOSE 8080<br>通常情况下，Tomcat启动后会监听8080端口，在容器中也一样。<br>EXPOSE指令用于标明，这个镜像中的应用将会侦听某个端口，并且希望能将这个端口映射到主机的网络界面上<br>（8）指定脚本的运行<br>至此，我们要做的准备工作就做完了。使用下面这条命令，运行我们在第6步创建的脚本，一个简单的Tomcat的Dockerfile就编写完成了。<br>ENTRYPOINT [“/app/tomcat7.sh”]<br>ENTRYPOINT 用于标明一个镜像作为容器运行时，最后要执行的程序或命令。</p><p>##3.构建镜像<br>进入Dockerfile所在目录，运行命令 docker build -t mytomcat .(注意最后有个点用来表示当前目录，初次构建速度会比较慢，需要多等一会。)</p><p><img src="https://img-blog.csdn.net/20180809221841415?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>出现如下信息就构建成功了</p><p><img src="https://img-blog.csdn.net/20180809221900753?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>##4.运行Docker容器<br>docker run -i -t -p 5000:8080 mytom<br>其中，docker run 用于运行一个容器<br>• -t 在容器指定一个伪终端或者终端;<br>• -i 进行命令交互;<br>• -p 匹配镜像内的网络端口号,即我们可以通过宿主机中访问5000端口来达到访问容器8080端口的目的。</p><p>##5.查看构建好的镜像和运行的容器<br>docker images #查看镜像<br><img src="https://img-blog.csdn.net/20180809221945480?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>docker ps -a #查看所有的容器<br><img src="https://img-blog.csdn.net/20180809222005522?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>##6.查看服务是否运行<br>在宿主机中我们输入localhost:5000访问，出现如下界面，表示Tomcat成功运行。</p><p><img src="https://img-blog.csdn.net/20180809222244245?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>至此，我们就成功的创建了一个Tomcat镜像了，当然这里只是为了简单演示，所以镜像做的比较简单，官方的Tomcat镜像比这复杂的多，在熟悉了Dockerfile后可以去看看官方的做法。</p><p>##7.其他<br>在做镜像的时候有那么多步骤，根本不可能一次将所有的步骤完成，所以，这里教给大家一个小技巧。<br>在编写完Dockerfile到第二步的时候，其实可以先使用一个脚本先运行着，然后进入容器内部进行操作。笔者在编写Dockerfile时先使用如下命令<br>COPY run.sh /app/run.sh<br>RUN chmod +x /app/run.sh<br>ENTRYPOINT [“/app/run.sh”]<br>run.sh脚本的内容如下</p><p>#!/bin/bash sleep 15 while true do echo “true” sleep 180 done<br>其实就是一段死循环代码代替原有的tomcat7.sh，接着就可以build和run我们的容器了。容器运行起来后使用docker exec -it container_id bash 进入docker容器。此时就和我们平时装软件的方式一样了，做完一个步骤，在Dockerfile中记录一条，这样Dockerfile也就做出来了。(ps:exit退出容器。)<br>特别注意的一点，如果做好镜像以后，在镜像中有需要保存的数据（持久化目录）需要我们在Dockerfile中指定持久化目录。为了能够保存（持久化）数据以及共享容器间的数据，Docker提出了Volume的概念。简单来说，Volume就是目录或者文件，它可以绕过默认的联合文件系统，而以正常的文件或者目录的形式存在于宿主机上。并且我们运行容器的时候需要使用使用 -v 来声明Volume，如：<br>docker run -it -v /home/dock/logs:/usr/logs tomcat /bin/bash<br>冒号前为宿主机目录，必须为绝对路径，冒号后为镜像内挂载的路径，这样容器内更改的数据就被写到宿主机上了。</p><p>#五、dockerFile指令</p><p>FROM</p><p>功能为指定基础镜像，并且必须是第一条指令。<br>如果不以任何镜像为基础，那么写法为：FROM scratch。<br>同时意味着接下来所写的指令将作为镜像的第一层开始</p><p>语法：<br>FROM<image><br>FROM<image>:<tag><br>FROM<image>:<digest><br>三种写法，其中<tag>和<digest> 是可选项，如果没有选择，那么默认值为latest</digest></tag></digest></image></tag></image></image></p><p>RUN<br>功能为运行指定的命令<br>RUN命令有两种格式</p><ol><li>RUN<command></command></li><li>RUN [“executable”, “param1”, “param2”]<br>第一种后边直接跟shell命令<br>• 在linux操作系统上默认 /bin/sh -c<br>• 在windows操作系统上默认 cmd /S /C<br>第二种是类似于函数调用。<br>可将executable理解成为可执行文件，后面就是两个参数。</li></ol><p>两种写法比对：<br>• RUN /bin/bash -c ‘source $HOME/.bashrc; echo $HOME<br>• RUN [“/bin/bash”, “-c”, “echo hello”]<br>注意：多行命令不要写多个RUN，原因是Dockerfile中每一个指令都会建立一层.<br>多少个RUN就构建了多少层镜像，会造成镜像的臃肿、多层，不仅仅增加了构件部署的时间，还容易出错。<br>RUN书写时的换行符是\</p><p>CMD</p><p>功能为容器启动时要运行的命令<br>语法有三种写法</p><ol><li>CMD [“executable”,”param1”,”param2”]</li><li>CMD [“param1”,”param2”]</li><li>CMD command param1 param2<br>第三种比较好理解了，就时shell这种执行方式和写法<br>第一种和第二种其实都是可执行文件加上参数的形式</li></ol><p>举例说明两种写法：<br>• CMD [ “sh”, “-c”, “echo $HOME”<br>• CMD [ “echo”, “$HOME” ]<br>补充细节：这里边包括参数的一定要用双引号，就是”,不能是单引号。千万不能写成单引号。<br>原因是参数传递后，docker解析的是一个JSON array</p><p>RUN &amp; CMD<br>不要把RUN和CMD搞混了。<br>RUN是构件容器时就运行的命令以及提交运行结果<br>CMD是容器启动时执行的命令，在构件时并不运行，构件时紧紧指定了这个命令到底是个什么样子</p><p>LABEL<br>功能是为镜像指定标签</p><p>语法：<br>LABEL<key>=<value><key>=<value><key>=<value> …<br>一个Dockerfile种可以有多个LABEL，如下：<br>LABEL “com.example.vendor”=”ACME Incorporated”<br>LABEL com.example.label-with-value=”foo”<br>LABEL version=”1.0”<br>LABEL description=”This text illustrates \<br>that label-values can span multiple lines.”<br>但是并不建议这样写，最好就写成一行，如太长需要换行的话则使用\符号<br>如下：<br>LABEL multi.label1=”value1” \<br>multi.label2=”value2” \<br>other=”value3”</value></key></value></key></value></key></p><p>说明：LABEL会继承基础镜像种的LABEL，如遇到key相同，则值覆盖</p><p>MAINTAINER<br>指定作者<br>语法：<br>MAINTAINER<name></name></p><p>EXPOSE<br>功能为暴漏容器运行时的监听端口给外部<br>但是EXPOSE并不会使容器访问主机的端口<br>如果想使得容器与主机的端口有映射关系，必须在容器启动的时候加上 -P参数</p><p>ENV<br>功能为设置环境变量<br>语法有两种</p><ol><li>ENV<key><value></value></key></li><li>ENV<key>=<value> …<br>两者的区别就是第一种是一次设置一个，第二种是一次设置多个</value></key></li></ol><p>ADD<br>一个复制命令，把文件复制到景象中。<br>如果把虚拟机与容器想象成两台linux服务器的话，那么这个命令就类似于scp，只是scp需要加用户名和密码的权限验证，而ADD不用。</p><p>语法如下：</p><ol><li>ADD<src>…<dest></dest></src></li><li>ADD [“<src>“,… “<dest>“]</dest></src></li></ol><p><dest>路径的填写可以是容器内的绝对路径，也可以是相对于工作目录的相对路径</dest></p><p><src>可以是一个本地文件或者是一个本地压缩文件，还可以是一个url</src></p><p>如果把<src>写成一个url，那么ADD就类似于wget命令</src></p><p>如以下写法都是可以的：<br>• ADD test relativeDir/<br>• ADD test /relativeDir<br>• ADD <a href="http://example.com/foobar" target="_blank" rel="noopener">http://example.com/foobar</a> /<br>尽量不要把<scr>写成一个文件夹，如果<src>是一个文件夹了，复制整个目录的内容,包括文件系统元数据</src></scr></p><p>COPY<br>看这个名字就知道，又是一个复制命令<br>语法如下：</p><ol><li>COPY<src>…<dest></dest></src></li><li>COPY [“<src>“,… “<dest>“]<br>与ADD的区别<br>COPY的<src>只能是本地文件，其他用法一致</src></dest></src></li></ol><p>ENTRYPOINT<br>功能是启动时的默认命令</p><p>语法如下：</p><ol><li>ENTRYPOINT [“executable”, “param1”, “param2”]</li><li>ENTRYPOINT command param1 param2</li></ol><p>如果从上到下看到这里的话，那么你应该对这两种语法很熟悉啦。<br>第二种就是写shell<br>第一种就是可执行文件加参数</p><p>与CMD比较说明（这俩命令太像了，而且还可以配合使用）：</p><ol><li><p>相同点：<br>• 只能写一条，如果写了多条，那么只有最后一条生效<br>• 容器启动时才运行，运行时机相同</p></li><li><p>不同点：<br>• ENTRYPOINT不会被运行的command覆盖，而CMD则会被覆盖<br>• 如果我们在Dockerfile种同时写了ENTRYPOINT和CMD，并且CMD指令不是一个完整的可执行命令，那么CMD指定的内容将会作为ENTRYPOINT的参数<br>如下：<br>FROM ubuntu<br>ENTRYPOINT [“top”, “-b”]<br>CMD [“-c”]<br>• 如果我们在Dockerfile种同时写了ENTRYPOINT和CMD，并且CMD是一个完整的指令，那么它们两个会互相覆盖，谁在最后谁生效<br>如下：<br>FROM ubuntu<br>ENTRYPOINT [“top”, “-b”]<br>CMD ls -al<br>那么将执行ls -al ,top -b不会执行。</p></li></ol><p>Docker官方使用一张表格来展示了ENTRYPOINT 和CMD不同组合的执行情况<br>（下方表格来自docker官网）</p><p><img src="https://img-blog.csdn.net/20180809222434584?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMjk2NTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>VOLUME</p><p>可实现挂载功能，可以将内地文件夹或者其他容器种得文件夹挂在到这个容器种</p><p>语法为：<br>VOLUME [“/data”]</p><p>说明：<br>[“/data”]可以是一个JsonArray ，也可以是多个值。所以如下几种写法都是正确的<br>VOLUME [“/var/log/“]<br>VOLUME /var/log<br>VOLUME /var/log /var/db<br>一般的使用场景为需要持久化存储数据时<br>容器使用的是AUFS，这种文件系统不能持久化数据，当容器关闭后，所有的更改都会丢失。<br>所以当数据需要持久化时用这个命令。</p><p>USER</p><p>设置启动容器的用户，可以是用户名或UID，所以，只有下面的两种写法是正确的<br>• USER daemo<br>• USER UID<br>注意：如果设置了容器以daemon用户去运行，那么RUN, CMD 和 ENTRYPOINT 都会以这个用户去运行</p><p>WORKDIR</p><p>语法：<br>WORKDIR /path/to/workdir</p><p>设置工作目录，对RUN,CMD,ENTRYPOINT,COPY,ADD生效。如果不存在则会创建，也可以设置多次。</p><p>如：<br>WORKDIR /a<br>WORKDIR b<br>WORKDIR c<br>RUN pwd<br>pwd执行的结果是/a/b/c</p><p>WORKDIR也可以解析环境变量<br>如：<br>ENV DIRPATH /path<br>WORKDIR $DIRPATH/$DIRNAME<br>RUN pwd<br>pwd的执行结果是/path/$DIRNAME</p><p>ARG<br>语法：<br>ARG<name>[=<default value="">]<br>设置变量命令，ARG命令定义了一个变量，在docker build创建镜像的时候，使用 –build-arg<varname>=<value>来指定参数<br>如果用户在build镜像时指定了一个参数没有定义在Dockerfile种，那么将有一个Warning<br>提示如下：<br>[Warning] One or more build-args [foo] were not consumed.</value></varname></default></name></p><p>我们可以定义一个或多个参数，如下：<br>FROM busybox<br>ARG user1<br>ARG buildno<br>…<br>也可以给参数一个默认值：<br>FROM busybox<br>ARG user1=someuser<br>ARG buildno=1<br>…<br>如果我们给了ARG定义的参数默认值，那么当build镜像时没有指定参数值，将会使用这个默认值</p><p>ONBUILD<br>语法：<br>ONBUILD [INSTRUCTION]<br>这个命令只对当前镜像的子镜像生效。<br>比如当前镜像为A，在Dockerfile种添加：<br>ONBUILD RUN ls -al<br>这个 ls -al 命令不会在A镜像构建或启动的时候执行</p><p>此时有一个镜像B是基于A镜像构建的，那么这个ls -al 命令会在B镜像构建的时候被执行。</p><p>STOPSIGNAL<br>语法：<br>STOPSIGNAL signal<br>STOPSIGNAL命令是的作用是当容器推出时给系统发送什么样的指令</p><p>HEALTHCHECK<br>容器健康状况检查命令<br>语法有两种：</p><ol><li>HEALTHCHECK [OPTIONS] CMD command</li><li>HEALTHCHECK NONE<br>第一个的功能是在容器内部运行一个命令来检查容器的健康状况<br>第二个的功能是在基础镜像中取消健康检查命令</li></ol><p>[OPTIONS]的选项支持以下三中选项：<br>–interval=DURATION 两次检查默认的时间间隔为30秒<br>–timeout=DURATION 健康检查命令运行超时时长，默认30秒<br>–retries=N 当连续失败指定次数后，则容器被认为是不健康的，状态为unhealthy，默认次数是3</p><p>注意：<br>HEALTHCHECK命令只能出现一次，如果出现了多次，只有最后一个生效。</p><p>CMD后边的命令的返回值决定了本次健康检查是否成功，具体的返回值如下：<br>0: success - 表示容器是健康的<br>1: unhealthy - 表示容器已经不能工作了<br>2: reserved - 保留值</p><p>例子：<br>HEALTHCHECK –interval=5m –timeout=3s \<br>CMD curl -f <a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a> || exit 1</p><p>健康检查命令是：curl -f <a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a> || exit 1<br>两次检查的间隔时间是5秒<br>命令超时时间为3秒</p></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/2018/08/15/java/javaweb技术/Docker容器基础知识/">Docker容器基础知识</a></p><p><span>文章作者:</span><a href="/" title="访问 QinHe 的个人博客">QinHe</a></p><p><span>发布时间:</span>2018年08月15日 - 18:08</p><p><span>最后更新:</span>2018年08月15日 - 18:08</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"> <img id="wechat_subscriber_qcode" src="/images/wechat-qcode.jpg" alt="QinHe wechat" style="width:200px;max-width:100%"><div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div></div></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Docker/" rel="tag"><i class="fa fa-tag"></i> Docker</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/08/09/java/javaweb技术/JSONP详解/" rel="next" title="JSONP详解"><i class="fa fa-chevron-left"></i> JSONP详解</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/08/16/java/springmvcAndSpringboot/Spring state machine 活动状态机 /" rel="prev" title="SpringStateMachine状态机">SpringStateMachine状态机<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b3f66ffa7f921c2" async="async"></script></div></div></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNzkxMC8xNDQ0MA=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/portrait.jpg" alt="QinHe"><p class="site-author-name" itemprop="name">QinHe</p><p class="site-description motion-element" itemprop="description">我的征途是星辰大海</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">33</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">39</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/qinheJ" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:qinheJ@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://plus.google.com/qinheJ" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span><span class="links-of-author-item"><a href="https://twitter.com/yourname" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a></li><li class="links-of-blogroll-item"> <a href="http://example.com/" title="Title" target="_blank">Title</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、增加linux的dns（永久）"><span class="nav-number">1.</span> <span class="nav-text">一、增加linux的dns（永久）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、docker安装"><span class="nav-number">2.</span> <span class="nav-text">二、docker安装</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">QinHe</span><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_pv">本站访客数:<span id="busuanzi_value_site_pv"></span></span></div></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共46.1k字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/lib/three/three.min.js"></script><script type="text/javascript" src="/lib/three/three-waves.min.js"></script><script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css"><script src="/lib/algolia-instant-search/instantsearch.min.js"></script><script src="/js/src/algolia-search.js?v=5.1.4"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",display:{position:"right",width:100,height:150},mobile:{show:!1}})</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>